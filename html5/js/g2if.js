(function(f){function e(a,i){if({}.hasOwnProperty.call(e.cache,a)){return e.cache[a]}var h=e.resolve(a);if(!h){throw new Error("Failed to resolve module "+a)}var j={id:a,require:e,filename:a,exports:{},loaded:!1,parent:i,children:[]};i&&i.children.push(j);var g=a.slice(0,a.lastIndexOf("/")+1);return e.cache[a]=j.exports,h.call(j.exports,j,j.exports,g,a),j.loaded=!0,e.cache[a]=j.exports}e.modules={},e.cache={},e.resolve=function(a){return{}.hasOwnProperty.call(e.modules,a)?e.modules[a]:void 0},e.define=function(a,g){e.modules[a]=g};var d=function(b){return b="/",{title:"browser",version:"v0.10.26",browser:!0,env:{},argv:[],nextTick:f.setImmediate||function(c){setTimeout(c,0)},cwd:function(){return b},chdir:function(a){b=a}}}();e.define("/gif.coffee",function(v,a,n,o){function s(g,c){return{}.hasOwnProperty.call(g,c)}function p(i,g){for(var h=0,j=g.length;h<j;++h){if(h in g&&g[h]===i){return !0}}return !1}function q(h,g){function i(){this.constructor=h}for(var j in g){s(g,j)&&(h[j]=g[j])}return i.prototype=g.prototype,h.prototype=new i,h.__super__=g.prototype,h}var r,w,t,x,u;t=e("events",v).EventEmitter,r=e("/browser.coffee",v),u=function(c){function b(i){var h,g;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(i);for(h in w){g=w[h],null!=this.options[h]?this.options[h]:this.options[h]=g}}return q(b,c),w={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null},x={delay:500,copy:!1},b.prototype.setOption=function(h,g){return this.options[h]=g,null!=this._canvas&&(h==="width"||h==="height")?this._canvas[h]=g:void 0},b.prototype.setOptions=function(g){var h,i;return function(j){for(h in g){if(!s(g,h)){continue}i=g[h],j.push(this.setOption(h,i))}return j}.call(this,[])},b.prototype.addFrame=function(g,i){var j,h;null==i&&(i={}),j={},j.transparent=this.options.transparent;for(h in x){j[h]=i[h]||x[h]}if(null!=this.options.width||this.setOption("width",g.width),null!=this.options.height||this.setOption("height",g.height),"undefined"!==typeof ImageData&&null!=ImageData&&g instanceof ImageData){j.data=g.data}else{if("undefined"!==typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&g instanceof CanvasRenderingContext2D||"undefined"!==typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&g instanceof WebGLRenderingContext){i.copy?j.data=this.getContextData(g):j.context=g}else{if(null!=g.childNodes){i.copy?j.data=this.getImageData(g):j.image=g}else{throw new Error("Invalid image")}}}return this.frames.push(j)},b.prototype.render=function(){var j,h;if(this.running){throw new Error("Already running")}if(!(null!=this.options.width&&null!=this.options.height)){throw new Error("Width and height must be set prior to rendering")}this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(z){for(var l=function(){var A;A=[];for(var B=0;0<=this.frames.length?B<this.frames.length:B>this.frames.length;0<=this.frames.length?++B:--B){A.push(B)}return A}.apply(this,arguments),m=0,y=l.length;m<y;++m){j=l[m],z.push(null)}return z}.call(this,[]),h=this.spawnWorkers();for(var k=function(){var m;m=[];for(var l=0;0<=h?l<h:l>h;0<=h?++l:--l){m.push(l)}return m}.apply(this,arguments),g=0,i=k.length;g<i;++g){j=k[g],this.renderNextFrame()}return this.emit("start"),this.emit("progress",0)},b.prototype.abort=function(){var g;while(!0){if(g=this.activeWorkers.shift(),!(null!=g)){break}console.log("killing active worker"),g.terminate()}return this.running=!1,this.emit("abort")},b.prototype.spawnWorkers=function(){var g;return g=Math.min(this.options.workers,this.frames.length),function(){var i;i=[];for(var h=this.freeWorkers.length;this.freeWorkers.length<=g?h<g:h>g;this.freeWorkers.length<=g?++h:--h){i.push(h)}return i}.apply(this,arguments).forEach(function(h){return function(j){var i;return console.log("spawning worker "+j),i=new Worker(h.options.workerScript),i.onmessage=function(k){return function(l){return k.activeWorkers.splice(k.activeWorkers.indexOf(i),1),k.freeWorkers.push(i),k.frameFinished(l.data)}}(h),h.freeWorkers.push(i)}}(this)),g},b.prototype.frameFinished=function(g){return console.log("frame "+g.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[g.index]=g,p(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},b.prototype.finishRendering=function(){var G,K,A,y,J,H,D;J=0;for(var F=0,B=this.imageParts.length;F<B;++F){K=this.imageParts[F],J+=(K.data.length-1)*K.pageSize+K.cursor}J+=K.pageSize-K.cursor,console.log("rendering finished - filesize "+Math.round(J/1000)+"kb"),G=new Uint8Array(J),H=0;for(var E=0,z=this.imageParts.length;E<z;++E){K=this.imageParts[E];for(var I=0,C=K.data.length;I<C;++I){D=K.data[I],A=I,G.set(D,H),A===K.data.length-1?H+=K.cursor:H+=K.pageSize}}return y=new Blob([G],{type:"image/gif"}),this.emit("finished",y,G)},b.prototype.renderNextFrame=function(){var i,h,g;if(this.freeWorkers.length===0){throw new Error("No free workers")}return this.nextFrame>=this.frames.length?void 0:(i=this.frames[this.nextFrame++],g=this.freeWorkers.shift(),h=this.getTask(i),console.log("starting frame "+(h.index+1)+" of "+this.frames.length),this.activeWorkers.push(g),g.postMessage(h))},b.prototype.getContextData=function(g){return g.getImageData(0,0,this.options.width,this.options.height).data},b.prototype.getImageData=function(g){var h;return null!=this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),h=this._canvas.getContext("2d"),h.setFill=this.options.background,h.fillRect(0,0,this.options.width,this.options.height),h.drawImage(g,0,0),this.getContextData(h)},b.prototype.getTask=function(h){var i,g;if(i=this.frames.indexOf(h),g={index:i,last:i===this.frames.length-1,delay:h.delay,transparent:h.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,repeat:this.options.repeat,canTransfer:r.name==="chrome"},null!=h.data){g.data=h.data}else{if(null!=h.context){g.data=this.getContextData(h.context)}else{if(null!=h.image){g.data=this.getImageData(h.image)}else{throw new Error("Invalid frame")}}}return g},b}(t),v.exports=u}),e.define("/browser.coffee",function(m,l,k,j){var r,o,n,p,q;p=navigator.userAgent.toLowerCase(),n=navigator.platform.toLowerCase(),q=p.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],o=q[1]==="ie"&&document.documentMode,r={name:q[1]==="version"?q[3]:q[1],version:o||parseFloat(q[1]==="opera"&&q[4]?q[4]:q[2]),platform:{name:p.match(/ip(?:ad|od|hone)/)?"ios":(p.match(/(?:webos|android)/)||n.match(/mac|win|linux/)||["other"])[0]}},r[r.name]=!0,r[r.name+parseInt(r.version,10)]=!0,r.platform[r.platform.name]=!0,m.exports=r}),e.define("events",function(k,l,j,i){d.EventEmitter||(d.EventEmitter=function(){});var b=l.EventEmitter=d.EventEmitter,n=typeof Array.isArray==="function"?Array.isArray:function(c){return Object.prototype.toString.call(c)==="[object Array]"},m=10;b.prototype.setMaxListeners=function(c){this._events||(this._events={}),this._events.maxListeners=c},b.prototype.emit=function(p){if(p==="error"&&(!(this._events&&this._events.error)||n(this._events.error)&&!this._events.error.length)){throw arguments[1] instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.")}if(!this._events){return !1}var h=this._events[p];if(!h){return !1}if(!(typeof h=="function")){if(n(h)){var c=Array.prototype.slice.call(arguments,1),q=h.slice();for(var r=0,o=q.length;r<o;r++){q[r].apply(this,c)}return !0}else{return !1}}switch(arguments.length){case 1:h.call(this);break;case 2:h.call(this,arguments[1]);break;case 3:h.call(this,arguments[1],arguments[2]);break;default:var c=Array.prototype.slice.call(arguments,1);h.apply(this,c)}return !0},b.prototype.addListener=function(g,c){if("function"!==typeof c){throw new Error("addListener only takes instances of Function")}if(this._events||(this._events={}),this.emit("newListener",g,c),!this._events[g]){this._events[g]=c}else{if(n(this._events[g])){if(!this._events[g].warned){var h;this._events.maxListeners!==undefined?h=this._events.maxListeners:h=m,h&&h>0&&this._events[g].length>h&&(this._events[g].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[g].length),console.trace())}this._events[g].push(c)}else{this._events[g]=[this._events[g],c]}}return this},b.prototype.on=b.prototype.addListener,b.prototype.once=function(g,p){var h=this;return h.on(g,function o(){h.removeListener(g,o),p.apply(this,arguments)}),this},b.prototype.removeListener=function(g,o){if("function"!==typeof o){throw new Error("removeListener only takes instances of Function")}if(!(this._events&&this._events[g])){return this}var c=this._events[g];if(n(c)){var h=c.indexOf(o);if(h<0){return this}c.splice(h,1),c.length==0&&delete this._events[g]}else{this._events[g]===o&&delete this._events[g]}return this},b.prototype.removeAllListeners=function(c){return c&&this._events&&this._events[c]&&(this._events[c]=null),this},b.prototype.listeners=function(c){return this._events||(this._events={}),this._events[c]||(this._events[c]=[]),n(this._events[c])||(this._events[c]=[this._events[c]]),this._events[c]}}),f.GIF=e("/gif.coffee")}.call(this,this));